<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIRLS 題組管理後台</title>
    <link rel="stylesheet" href="assets/css/admin.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <!-- 密碼驗證模態框 -->
    <div id="passwordModal" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 9999;">
        <div style="background: white; padding: 40px; border-radius: 16px; text-align: center; max-width: 400px;">
            <h2 style="margin-bottom: 20px; color: #4f46e5;">🔒 管理員驗證</h2>
            <p style="color: #666; margin-bottom: 20px;">請輸入後台密碼以繼續</p>
            <input type="password" id="adminPassword" placeholder="輸入密碼" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 15px;">
            <button onclick="checkAdminPassword()" style="width: 100%; padding: 12px; background: #4f46e5; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">確認</button>
            <p id="passwordError" style="color: red; margin-top: 10px; display: none;">密碼錯誤！</p>
        </div>
    </div>
    <script src="assets/js/auth-helper.js"></script>

    <div class="admin-container">
        <!-- 側邊欄 -->
        <aside class="sidebar">
            <div class="logo">
                <h1>📚 PIRLS</h1>
                <p>題組管理後台</p>
            </div>
            <nav>
                <a href="#" class="nav-item active">📤 上傳題組</a>
                <a href="ai-generate.html" class="nav-item">🤖 AI 生成</a>
                <a href="admin.html" class="nav-item">📊 數據中心</a>
                <a href="index.html" class="nav-item">🏠 返回首頁</a>
            </nav>
            <div class="stats-box">
                <h3>目前題組數</h3>
                <div class="stat-number" id="total-count">載入中...</div>
            </div>
        </aside>

        <!-- 主內容區 -->
        <main class="main-content">
            <header>
                <h2>📤 上傳新題組</h2>
                <p>上傳 PaGamO 格式的 Excel 檔案，自動產生 PIRLS 題組</p>
            </header>

            <!-- 步驟指示器 -->
            <div class="steps-indicator">
                <div class="step active" id="step-1-indicator">
                    <span class="step-number">1</span>
                    <span class="step-label">上傳檔案</span>
                </div>
                <div class="step" id="step-2-indicator">
                    <span class="step-number">2</span>
                    <span class="step-label">預覽內容</span>
                </div>
                <div class="step" id="step-3-indicator">
                    <span class="step-number">3</span>
                    <span class="step-label">確認儲存</span>
                </div>
            </div>

            <!-- 步驟 1: 上傳檔案 -->
            <section id="step-1" class="step-content active">
                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">📁</div>
                    <h3>拖放 Excel 檔案到此處</h3>
                    <p>或點擊選擇檔案</p>
                    <input type="file" id="file-input" accept=".xlsx,.xls" hidden>
                    <button class="btn btn-primary"
                        onclick="event.stopPropagation(); document.getElementById('file-input').click()">
                        選擇檔案
                    </button>
                </div>
                <div class="format-hint">
                    <h4>📋 檔案格式要求</h4>
                    <ul>
                        <li>PaGamO 格式的 Excel 檔案（.xlsx）</li>
                        <li>科目欄位需包含「閱讀素養題組」</li>
                        <li>題目使用子編號格式（如 1_1, 1_2, ...）</li>
                    </ul>
                </div>
            </section>

            <!-- 步驟 2: 預覽內容 -->
            <section id="step-2" class="step-content">
                <div class="preview-header">
                    <h3>📖 解析結果預覽</h3>
                    <div class="id-input">
                        <label>題組 ID：</label>
                        <input type="number" id="article-id" min="1" placeholder="自動產生">
                        <span class="hint">留空將自動使用下一個可用 ID</span>
                    </div>
                </div>

                <div class="preview-card">
                    <div class="preview-section">
                        <h4>📰 文章標題</h4>
                        <div id="preview-title" class="preview-content">-</div>
                    </div>

                    <div class="preview-section">
                        <h4>📝 文章內容（<span id="paragraph-count">0</span> 段落）</h4>
                        <div id="preview-content" class="preview-content scrollable">-</div>
                    </div>

                    <div class="preview-section">
                        <h4>❓ 題目列表（<span id="question-count">0</span> 題）</h4>
                        <div id="preview-questions" class="preview-content scrollable">-</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="resetUpload()">← 重新上傳</button>
                    <button class="btn btn-primary" onclick="saveQuiz()">確認並儲存 →</button>
                </div>
            </section>

            <!-- 步驟 3: 完成 -->
            <section id="step-3" class="step-content">
                <div class="success-message">
                    <div class="success-icon">✅</div>
                    <h3>題組產生成功！</h3>
                    <div class="result-info">
                        <p>題組 ID：<strong id="result-id">-</strong></p>
                        <p>標題：<strong id="result-title">-</strong></p>
                        <p>題目數：<strong id="result-questions">-</strong></p>
                    </div>
                    <div class="action-buttons">
                        <a id="test-link" href="#" class="btn btn-primary" target="_blank">🔗 開啟測試頁面</a>
                        <button class="btn btn-secondary" onclick="resetUpload()">上傳另一個題組</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="assets/js/admin.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é–±è®€ç†è§£ç·´ç¿’ï¼šåŸ¹è‚²å‰µæ„çš„èŠ±åœ’</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        :root {
            --primary-color: #4169e1;
            --secondary-color: #00a86b;
            --accent-color: #ffd700;
            --text-color: #333;
            --bg-color: #f0f8ff;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            -webkit-text-size-adjust: 100%;
        }

        /* æ¡Œé¢ç‰ˆé è¨­æ¨£å¼ (ä¸‰æ¬„å¼) */
        .container {
            display: flex;
            flex-direction: row;
            height: 100vh;
            overflow: hidden;
        }

        .column {
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* å·¦å´æ¬„ */
        #left-column {
            width: 20%;
            background-color: var(--secondary-color);
            color: white;
        }

        /* ä¸­é–“æ¬„ */
        #center-column {
            width: 50%;
            background-color: white;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            line-height: 1.8;
            font-size: 1.15rem;
            text-align: justify;
        }

        /* å³å´æ¬„ */
        #right-column {
            width: 30%;
            background-color: #fffbe6;
            border-left: 5px solid var(--accent-color);
        }

        h1 { font-size: 1.8rem; margin-bottom: 1rem; color: #00008b; }
        h2 { font-size: 1.4rem; margin-bottom: 1rem; color: #00008b; }
        #left-column h2 { color: white; }

        .step {
            margin-bottom: 15px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }

        .question {
            margin-bottom: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .question p {
            font-weight: bold;
            margin-bottom: 12px;
            color: #2c3e50;
            line-height: 1.5;
        }

        .option {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            margin: 8px 0;
            background-color: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #e9ecef;
            min-height: 44px; 
        }

        .option:hover, .option:active {
            background-color: #e3f2fd;
            border-color: var(--primary-color);
        }

        .option input[type="radio"] {
            margin-right: 12px;
            margin-top: 5px;
            transform: scale(1.3);
            flex-shrink: 0;
        }

        button.submit-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 18px;
            border-radius: 50px;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(65, 105, 225, 0.3);
        }

        button.submit-btn:active {
            transform: scale(0.98);
        }

        button.submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* é ‚éƒ¨ä½¿ç”¨è€…è³‡è¨Šåˆ— (æ‰‹æ©Ÿç‰ˆ) */
        #user-info-bar {
            display: none; 
            background: white;
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #555;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* ç™»å…¥ Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 10vh; 
            z-index: 1000;
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }

        .login-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            margin-bottom: 50px;
        }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #444; }
        
        .select-row {
            display: flex;
            gap: 10px;
        }
        
        .select-row select {
            flex: 1; 
            min-width: 0;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background-color: #fff;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* RWD æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media screen and (max-width: 900px) {
            .container {
                flex-direction: column;
                height: auto;
                overflow: visible;
            }

            #user-info-bar { display: flex; }
            #desktop-user-info { display: none; }

            .column {
                width: 100% !important;
                overflow: visible;
                height: auto;
                max-height: none;
                padding: 15px;
            }

            #left-column {
                background-color: var(--secondary-color);
                padding: 15px;
            }
            
            #left-column .step p { display: none; } 
            #left-column .step { 
                display: inline-block; 
                margin: 5px; 
                padding: 5px 10px; 
                font-size: 0.85rem;
            }
            #left-column h2 { font-size: 1.2rem; margin-bottom: 5px; display: inline-block; margin-right: 10px;}
            
            #center-column {
                border: none;
                border-bottom: 5px solid #eee;
                padding: 20px 15px;
            }

            #right-column {
                border-left: none;
                background-color: #fafafa;
                padding-bottom: 50px;
            }

            h1 { font-size: 1.5rem; }
            #center-column { font-size: 1.1rem; }
        }
        
        /* çµæœå›é¥‹ */
        .explanation {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.95rem;
            line-height: 1.5;
            display: none;
        }
        .explanation.show { display: block; animation: fadeIn 0.5s; }
        .explanation.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .explanation.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .highlight { background-color: #fff3cd; padding: 0 2px; font-weight: bold; }

        /* æ­·å²ç´€éŒ„ */
        #history-section { margin-top: 30px; border-top: 2px dashed #ccc; padding-top: 20px; }
        .history-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #ddd;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .history-item.high-score { border-left-color: #28a745; }
        .history-item.low-score { border-left-color: #dc3545; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<!-- ç™»å…¥æ¨¡æ…‹æ¡† -->
<div id="loginModal" class="modal-overlay">
    <div class="login-card">
        <h2 style="text-align: center; color: var(--primary-color);">é–±è®€æŒ‘æˆ°ç™»å…¥</h2>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">è«‹è¼¸å…¥è³‡æ–™ä»¥ç´€éŒ„æˆç¸¾</p>
        
        <div class="form-group">
            <label>ç­ç´šé¸æ“‡</label>
            <div class="select-row">
                <select id="gradeSelect" class="form-control">
                    <option value="" disabled selected>å¹´ç´š</option>
                    <option value="ä¸€">ä¸€å¹´ç´š</option>
                    <option value="äºŒ">äºŒå¹´ç´š</option>
                    <option value="ä¸‰">ä¸‰å¹´ç´š</option>
                    <option value="å››">å››å¹´ç´š</option>
                    <option value="äº”">äº”å¹´ç´š</option>
                    <option value="å…­">å…­å¹´ç´š</option>
                    <option value="ç‰¹æ•™">ç‰¹æ•™ç­</option>
                    <option value="ç§‘ä»»">ç§‘ä»»æ•™å®¤</option>
                </select>
                <select id="classNumberSelect" class="form-control">
                    <option value="" disabled selected>ç­ç´š</option>
                    <!-- JS ç”Ÿæˆ -->
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="studentName">å§“å</label>
            <input type="text" id="studentName" class="form-control" placeholder="è«‹è¼¸å…¥å§“å">
        </div>

        <div class="form-group">
             <label for="seatNumber">åº§è™Ÿ (é¸å¡«)</label>
             <input type="tel" id="seatNumber" class="form-control" placeholder="ä¾‹å¦‚: 05">
        </div>

        <button class="submit-btn" onclick="saveUserInfo()">é–‹å§‹æ¸¬é©—</button>
    </div>
</div>

<!-- æ‰‹æ©Ÿç‰ˆé ‚éƒ¨è³‡è¨Šåˆ— -->
<div id="user-info-bar">
    <div>
        <span style="font-weight: bold; color: var(--primary-color);">ğŸ‘¤ <span id="mobile-user-name">æœªç™»å…¥</span></span>
    </div>
    <div>
        <button onclick="resetUser()" style="background: #f0f0f0; border: 1px solid #ddd; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; color: #555;">åˆ‡æ›</button>
        <a href="index.html" style="margin-left: 8px; color: var(--secondary-color); text-decoration: none; font-weight: bold;">ğŸ  é¦–é </a>
    </div>
</div>

<div class="container">
  <!-- å·¦å´æ¬„ -->
  <div id="left-column" class="column">
    <h2>ä½¿ç”¨æŒ‡å—</h2>
    
    <!-- æ¡Œæ©Ÿç‰ˆä½¿ç”¨è€…è³‡è¨Š -->
    <div id="desktop-user-info" style="margin-bottom: 20px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
        <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 5px;">ç›®å‰ä½¿ç”¨è€…</div>
        <div id="desktop-user-name" style="font-weight: bold; font-size: 1.2rem; margin-bottom: 10px;">æœªç™»å…¥</div>
        <button onclick="resetUser()" style="background: transparent; border: 1px solid white; color: white; padding: 4px 10px; font-size: 0.8rem; cursor: pointer; border-radius: 4px; width: 100%;">åˆ‡æ›ä½¿ç”¨è€…</button>
        <div style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px;">
            <a href="index.html" style="color: white; text-decoration: none; display: block;">â† è¿”å›æ–‡ç« åˆ—è¡¨</a>
        </div>
    </div>

    <div class="step">
      <h3>æ­¥é©Ÿ 1</h3>
      <p>ä»”ç´°é–±è®€ä¸­é–“çš„æ–‡ç« ï¼Œæ³¨æ„ç´°ç¯€ã€‚</p>
    </div>
    <div class="step">
      <h3>æ­¥é©Ÿ 2</h3>
      <p>å›ç­”å³å´çš„4å€‹å•é¡Œã€‚</p>
    </div>
    <div class="step">
      <h3>æ­¥é©Ÿ 3</h3>
      <p>æäº¤å¾Œï¼Œç³»çµ±æœƒè‡ªå‹•å„²å­˜æ‚¨çš„æˆç¸¾ã€‚</p>
    </div>
  </div>

  <!-- ä¸­é–“æ¬„ -->
  <div id="center-column" class="column">
    <!-- 
         æ³¨æ„ï¼šæ­¤è™•æ¨™é¡Œèˆ‡å…§å®¹ç”±ä¸‹æ–¹ JavaScript é…ç½®æ±ºå®š 
         ç‚ºäº†é¿å…æ··æ·†ï¼Œé€™è£¡çš„æ–‡å­—å»ºè­°èˆ‡ä¸‹æ–¹ ARTICLE_TITLE ä¿æŒä¸€è‡´
    -->
    <h1 id="article-title-display">é–±è®€æ–‡ç« ï¼šåŸ¹è‚²å‰µæ„çš„èŠ±åœ’</h1>
    
    <div id="article-body">
        <p>ç•¶æ˜¥å¤©ä¾†è‡¨æ™‚ï¼ŒèŠ±åœ’è£¡ç™¾èŠ±ç››é–‹ï¼Œè®“äººè³å¿ƒæ‚…ç›®ã€‚ä½ æ˜¯å¦æ›¾æƒ³éï¼Œç‚ºä»€éº¼å‰å¤§çš„è—è¡“å®¶ç¸½èƒ½å‰µä½œå‡ºä»¤äººé©šå˜†çš„ä½œå“ï¼Œå°±æœ‰é€™éº¼å¤šä¸åŒçš„ç¨®é¡å‘¢ï¼Ÿé‚£æ˜¯å› ç‚ºå®ƒå€‘æºæ–¼ã€Œå…’ç«¥ã€ï¼</p>
        <p>ä»€éº¼æ„æ€ï¼Ÿç”±æ–¼ç’°å¢ƒä¸€ç›´åœ¨è®Šï¼Œç”Ÿç‰©ä¹Ÿè¦è·Ÿè‘—è®Šï¼Œæ‰èƒ½å¤ ç”Ÿå­˜ä¸‹å»ã€‚å¯æ˜¯å®ƒå€‘çš„åŸºå› ä¸çŸ¥é“è©²æ€éº¼è®Šèº«æ‰ã€Œæ­£ç¢ºã€ï¼Œåªèƒ½ä¸æ–·å˜—è©¦å„ç¨®å¯èƒ½çš„æ–¹å‘ï¼Œè©¦äº†ä¸€ç™¾æ¬¡ï¼Œç¶“éå¤©æ“‡ï¼Œçµæœåªæœ‰äº”æ¬¡å¤±æ•—ï¼Œé‚£ä¹åäº”æ¬¡å¤±æ•—çš„çµæœé›–ç„¶æ¶ˆå¤±ï¼Œå»æœ‰è‘—ç„¡å¯å–ä»£çš„é‡è¦æ€§ã€‚</p>
        <p>å‰µæ„æ€è€ƒçš„åŸç†å¾ˆé¡ä¼¼é€™å€‹éç¨‹ï¼Œå¿…é ˆè—‰å¯èƒ½è·³è„«èˆŠæœ‰çš„ç¿’æ…£ï¼ŒåŠ å…¥æ–°åˆºæ¿€ï¼Œæ–°æƒ³æ³•ã€‚å…ˆæ±‚ã€Œæœ‰ã€èˆ‡ã€Œå¤šã€ï¼Œå†ä¾†ã€Œä¿®æ”¹ã€èˆ‡ã€Œæ•´ç†ã€ã€‚ä¸éœ€è‹›æ±‚ä¸€æ­¥åˆ°ä½ï¼Œç”šè‡³è¦ä¸æ€•ã€Œå‡ºéŒ¯ã€ï¼Œåªè¦è¶³å¤ ã€Œå°ã€äº†ï¼è®“æˆ‘å€‘å¿«å¿«é€²å…¥æ€è€ƒçš„èŠ±åœ’ï¼Œæ¢ç´¢æœ‰å“ªäº›åŸ¹è‚²å‰µæ„çš„å¥½æ–¹æ³•ï¼</p>
        <p>ç¬¬ä¸€å€‹æ–¹æ³•æ˜¯ã€ŒæŠŠæ–‡å­—ç§»æˆåœ–æ¡ˆã€ã€‚ç•¶ä½ çœ‹åˆ°ç†Ÿæ‚‰çš„æ–‡å­—æˆ–æ•¸å­—ï¼Œè…¦ä¸­å¾ˆå¿«æœƒæµ®ç¾ç›¸å°æ‡‰çš„è®€éŸ³ã€æ„ç¾©ã€æƒ…å¢ƒç­‰ã€‚é›–ç„¶é€™ç¨®ç›´è¦ºå¾ˆå¯¦ç”¨ï¼Œä½†å¦‚æœç”¨å®ƒå€‘å‰µä½œäº†ä¸€ç¨®åœ–å½¢ï¼Œç›¸è¼ƒä¹‹ä¸‹ï¼Œåœ–åƒçš„å°æ‡‰å°±é–‹æ”¾è¨±å¤šï¼Œæ¯”å¦‚ä¸‰è§’å½¢ï¼Œé™¤äº†æ˜¯æ•¸å­¸ç¬¦è™Ÿï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€æœµèŠ±ã€å¸†èˆ¹ã€æˆ–è´è¶çš„ç¿…è†€ã€‚</p>
        <p>ç¬¬äºŒå€‹æ–¹æ³•æ˜¯ã€Œç•«ä¸€æ£µè¯æƒ³æ¨¹ã€ã€‚ä½ æ›¾ç¶“æ‹ç…§ï¼Œè¢«æ¨¹ææˆ–çˆ¶æ¯çš„å½¢ç‹€é®ä½äº†å—ï¼Ÿå¾ä¸»å¹¹å»¶ä¼¸å‡ºæå¹¹ï¼Œå†åˆ†å‡ºæ›´ç´°å°çš„ææ¢ï¼Œå¾€å››é¢å…«æ–¹å±•é–‹ï¼Œç”šè‡³åƒè¿·å®®ä¸€æ¨£ã€‚æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘å€‘çš„å¤§è…¦æƒ³æ³•å°±åƒæ˜¯ã€Œè¯æƒ³ã€ï¼Œåªè¦æœ‰ä»¥ä¸Šã€Œå¤šæ”¯ã€ä½œç‚ºé—œéµå­—ï¼Œä½ å¯ä»¥å‡ºç¾å¤šå°‘è¯æƒ³çš„åˆ†æ”¯ï¼Ÿå¯’å†·ã€ç™½è‰²ã€è½è‘‰ã€å‡‹é›¶......è€Œå¯’å†·åˆå¯ä»¥åˆ†æ”¯å‡ºåœå·¾ã€æ‰“é¡«ã€æš–æ°£......æƒ³å¾—å·®ä¸å¤šå¾Œï¼Œå†è©¦è‘—åˆ†çµ„ï¼ŒåŒä¸€çµ„ç”¨ä¸€ç¨®é¡è‰²æ¨™ç¤ºï¼Œé€™æ¨£å¯ä»¥çœ‹å‡ºï¼Œé‚„æœ‰å“ªäº›è³‡è¨Šä¸è¶³ï¼Œæˆ–å“ªå€‹éƒ¨åˆ†é‚„è¦å†ä¿®æ”¹ã€‚</p>
        <p>ç¬¬ä¸‰å€‹æ–¹æ³•æ˜¯ã€Œé€™å€‹AåŠ é‚£å€‹Bã€ã€‚å°æ™‚å€™ç©ç©å…·ï¼Œæœ‰äº›äººå–œæ­¡æŠŠç©å…·æ‹†é–‹ï¼Œé™¤äº†çœ‹çœ‹è£¡é¢åˆ°åº•æ˜¯æ€æ¨£ï¼Œé‚„æœƒæ ¹æ“šè‡ªå·±çš„èˆˆè¶£å†çµ„èµ·ã€‚é€™æ™‚å€™å‰µæ„çš„ç—•è·¡å°±ä¸å¿…ç„¶æ˜é¡¯ï¼Œè€Œæ˜¯æ¨é™³å‡ºæ–°ï¼ŒæŠŠç¾æœ‰çš„æ±è¥¿é‡æ–°æ’åˆ—çµ„åˆï¼Œèª•ç”Ÿæ–°çš„æƒ³åƒã€‚æ€éº¼åšï¼Ÿä¸å¦¨å‹•å‹•æ‰‹è’é›†å»£å‘Šå‚³å–®æˆ–é›œèªŒé ï¼ŒæŠŠæœ‰æ„Ÿè¦ºçš„æ±è¥¿å‰ªä¸‹ä¾†ï¼Œç„¶å¾Œæ”¾é€²å°ç®±å­è£¡æ“ºä¸€æ“ºï¼ŒæŠ½å‡ºäº”å¼µï¼Œçµ„åˆå®ƒå€‘ï¼Œè©¦è‘—å‰µé€ ä¸€å€‹é€£ä½ éƒ½æ²’æƒ³éçš„ç¨ç‰¹ç”Ÿç‰©å§ã€‚</p>
        <p>æœ€å¾Œä¸€å€‹æ–¹æ³•æ˜¯ã€Œè…¦åŠ›å¤§é¢¨å¹ã€ã€‚ä¸‰å€‹è‡­çš®åŒ ï¼Œå‹éä¸€å€‹è«¸è‘›äº®ã€‚è·Ÿå¤§å®¶ä¸€èµ·è…¦åŠ›æ¿€ç›ªï¼Œæœƒæœ‰æ›´å¤šä»¤äººæ„æƒ³ä¸åˆ°çš„æƒ³æ³•è¹¦å‡ºä¾†ï¼Œä¹Ÿæ›´åŠ æœ‰è¶£ã€‚åˆä½œæ™‚ï¼Œå¦‚ä½•ç‡Ÿé€ æœ‰å‰µæ„çš„ç’°å¢ƒï¼Ÿæœ€é‡è¦çš„ï¼Œå°±æ˜¯å½¼æ­¤ä¿¡ä»»ã€ä»°æœ›æ˜Ÿç©ºï¼šå°æ¯å€‹äººçš„æƒ³æ³•ä¸æ‰¹è©•ã€å°ˆæ³¨è†è½ã€ä¸è©¦åœ–æ”¹è®Šå°æ–¹ã€‚æ‰¾æ‰¾ä½ çš„å¥½åŒå­¸ï¼Œé¸ä¸€å€‹ä½ å€‘å…±åŒæ„Ÿèˆˆè¶£çš„äº‹ï¼Œæ¯”å¦‚ã€Œå¦‚ä½•è®“å­¸æ ¡çš„ç‡Ÿé¤Šåˆé¤æ›´å¥½åƒã€ï¼Œæƒ³ä¸€æƒ³ï¼Œæœ‰å“ªäº›å¥½é»å­ï¼Ÿ</p>
    </div>
    
    <!-- æœ¬æ¬¡æˆç¸¾é¡¯ç¤ºå€ -->
    <div id="current-stats" style="display:none; background-color: #f0f8ff; padding: 20px; border-radius: 10px; margin-top: 30px; border: 1px solid #b3d7ff;">
        <!-- é€™è£¡é¡¯ç¤ºæœ¬æ¬¡æˆç¸¾ -->
    </div>
  </div>

  <!-- å³å´æ¬„ -->
  <div id="right-column" class="column">
    <h2>é–±è®€ç†è§£å•é¡Œ</h2>
    
    <!-- Q1 -->
    <div class="question" id="q-block-1">
      <p>1. æ ¹æ“šæ–‡ç« ï¼Œå‰µæ„æ€è€ƒçš„éç¨‹ä¸­ï¼Œå…ˆæ±‚ä»€éº¼ï¼Œå†æ±‚ä»€éº¼ï¼Ÿï¼ˆç›´æ¥æå–è¨Šæ¯ï¼‰</p>
      <label class="option"><input type="radio" name="q1" value="a"> å…ˆæ±‚å®Œç¾ï¼Œå†æ±‚å‰µæ–°</label>
      <label class="option"><input type="radio" name="q1" value="b"> å…ˆæ±‚æœ‰å’Œå¤šï¼Œå†æ±‚ä¿®æ”¹å’Œæ•´ç†</label>
      <label class="option"><input type="radio" name="q1" value="c"> å…ˆæ±‚è³ªé‡ï¼Œå†æ±‚æ•¸é‡</label>
      <label class="option"><input type="radio" name="q1" value="d"> å…ˆæ±‚æ­£ç¢ºï¼Œå†æ±‚å‰µæ„</label>
      <div class="explanation" id="exp1"></div>
    </div>

    <!-- Q2 -->
    <div class="question" id="q-block-2">
      <p>2. ç‚ºä»€éº¼ä½œè€…èªç‚ºã€Œä¸éœ€è‹›æ±‚ä¸€æ­¥åˆ°ä½ï¼Œç”šè‡³è¦ä¸æ€•å‡ºéŒ¯ã€ï¼Ÿï¼ˆæ¨è«–è¨Šæ¯ï¼‰</p>
      <label class="option"><input type="radio" name="q2" value="a"> å› ç‚ºéŒ¯èª¤å¯ä»¥å¢åŠ è¶£å‘³æ€§</label>
      <label class="option"><input type="radio" name="q2" value="b"> å› ç‚ºå®Œç¾ä¸»ç¾©æœƒé˜»ç¤™å‰µæ„</label>
      <label class="option"><input type="radio" name="q2" value="c"> å› ç‚ºå˜—è©¦å’Œå¤±æ•—æ˜¯å‰µæ„éç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†</label>
      <label class="option"><input type="radio" name="q2" value="d"> å› ç‚ºå‡ºéŒ¯å¯ä»¥çœæ™‚çœåŠ›</label>
      <div class="explanation" id="exp2"></div>
    </div>

    <!-- Q3 -->
    <div class="question" id="q-block-3">
      <p>3. æ–‡ç« ä¸­æåˆ°çš„å››ç¨®åŸ¹è‚²å‰µæ„çš„æ–¹æ³•ä¸­ï¼Œå“ªä¸€ç¨®ç‰¹åˆ¥å¼·èª¿åœ˜éšŠåˆä½œï¼Ÿï¼ˆè©®é‡‹æ•´åˆè¨Šæ¯ï¼‰</p>
      <label class="option"><input type="radio" name="q3" value="a"> æŠŠæ–‡å­—ç§»æˆåœ–æ¡ˆ</label>
      <label class="option"><input type="radio" name="q3" value="b"> ç•«ä¸€æ£µè¯æƒ³æ¨¹</label>
      <label class="option"><input type="radio" name="q3" value="c"> é€™å€‹AåŠ é‚£å€‹B</label>
      <label class="option"><input type="radio" name="q3" value="d"> è…¦åŠ›å¤§é¢¨å¹</label>
      <div class="explanation" id="exp3"></div>
    </div>

    <!-- Q4 -->
    <div class="question" id="q-block-4">
      <p>4. æ ¹æ“šæ–‡ç« ï¼Œä½œè€…å°åŸ¹è‚²å‰µæ„çš„æ…‹åº¦æœ€å¯èƒ½æ˜¯ä»€éº¼ï¼Ÿï¼ˆè©•é‘‘æ–‡æœ¬å…§å®¹èˆ‡æ‰‹æ³•ï¼‰</p>
      <label class="option"><input type="radio" name="q4" value="a"> å‰µæ„æ˜¯å¤©ç”Ÿçš„ï¼Œç„¡æ³•åŸ¹é¤Š</label>
      <label class="option"><input type="radio" name="q4" value="b"> å‰µæ„éœ€è¦åš´æ ¼çš„è¨“ç·´å’Œå®Œç¾ä¸»ç¾©</label>
      <label class="option"><input type="radio" name="q4" value="c"> å‰µæ„å¯ä»¥é€šéå¤šæ¨£åŒ–çš„æ–¹æ³•å’Œé–‹æ”¾çš„æ…‹åº¦ä¾†åŸ¹é¤Š</label>
      <label class="option"><input type="radio" name="q4" value="d"> å‰µæ„åªå­˜åœ¨æ–¼è—è¡“é ˜åŸŸ</label>
      <div class="explanation" id="exp4"></div>
    </div>

    <button class="submit-btn" id="submitBtn" onclick="checkAnswers()">æäº¤ç­”æ¡ˆ</button>
    
    <div id="history-section">
        <h3>ğŸ“ æ‚¨çš„æ­·å²ç´€éŒ„ (æœ¬ç¯‡)</h3>
        <div id="history-list">è¼‰å…¥ä¸­...</div>
    </div>
  </div>
</div>

<script type="module">
    // ==========================================================================
    // ğŸ“Œ æ–‡ç« åƒæ•¸è¨­å®šå€ (è¤‡è£½æ­¤æª”æ¡ˆæ™‚ï¼Œåƒ…éœ€ä¿®æ”¹æ­¤å€å¡Šå³å¯)
    // ==========================================================================
    
    const ARTICLE_CONFIG = {
        id: 14, // æ–‡ç« ç·¨è™Ÿ (æ³¨æ„ï¼šè«‹ç¢ºä¿èˆ‡æª”åæˆ–è³‡æ–™åº«é‚è¼¯ä¸€è‡´)
        title: "åŸ¹è‚²å‰µæ„çš„èŠ±åœ’", // æ–‡ç« æ¨™é¡Œ
        answers: ['b', 'c', 'd', 'c'], // æ­£ç¢ºç­”æ¡ˆ (q1~q4)
        hints: [
            "æç¤ºï¼šè«‹ä»”ç´°é–±è®€æ–‡ç« çš„<span class='highlight'>ç¬¬ä¸‰æ®µ</span>ï¼Œå°‹æ‰¾é—œæ–¼<span class='highlight'>å‰µæ„æ€è€ƒéç¨‹</span>çš„ç›´æ¥æè¿°ã€‚",
            "æç¤ºï¼šçµåˆæ–‡ç« <span class='highlight'>ç¬¬äºŒæ®µ</span>å’Œ<span class='highlight'>ç¬¬ä¸‰æ®µ</span>çš„ä¿¡æ¯ï¼Œæ€è€ƒ<span class='highlight'>ä½œè€…å°éŒ¯èª¤çš„æ…‹åº¦</span>å’Œ<span class='highlight'>å‰µæ„éç¨‹çš„æè¿°</span>ã€‚",
            "æç¤ºï¼šè«‹ä»”ç´°é–±è®€æ–‡ç« çš„<span class='highlight'>æœ€å¾Œä¸€æ®µ</span>ï¼Œæ¯”è¼ƒå„ç¨®æ–¹æ³•çš„<span class='highlight'>ç‰¹é»å’Œéç¨‹</span>ã€‚",
            "æç¤ºï¼šå›é¡§<span class='highlight'>æ•´ç¯‡æ–‡ç« </span>ï¼Œç‰¹åˆ¥æ˜¯<span class='highlight'>æœ€å¾Œä¸€æ®µ</span>ï¼Œè©•ä¼°ä½œè€…å°<span class='highlight'>åŸ¹é¤Šå‰µæ„èƒ½åŠ›çš„æ•´é«”æ…‹åº¦</span>ã€‚"
        ]
    };

    // ==========================================================================
    // ğŸš€ ç³»çµ±é‚è¼¯å€ (ä»¥ä¸‹é€šå¸¸ä¸éœ€è¦ä¿®æ”¹)
    // ==========================================================================

    // Firebase Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, doc, addDoc, setDoc, getDocs, query, where, orderBy, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // Firebase Config
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
         apiKey: "AIzaSyDpNO7HktKVmMRAEwiKlU1gJ6RTb9qaUm4",
         authDomain: "shimen-pirls.firebaseapp.com",
         projectId: "shimen-pirls",
         storageBucket: "shimen-pirls.firebasestorage.app",
         messagingSenderId: "908294261992",
         appId: "1:908294261992:web:948474ea7c2a662a778d5d"
    };

    const appId = typeof __app_id !== 'undefined' ? __app_id : "shimen-pirls"; 

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // ç‹€æ…‹è®Šæ•¸
    let startTime = new Date();
    let currentUser = null; 

    // DOM è¼‰å…¥å¾ŒåŸ·è¡Œ
    window.addEventListener('DOMContentLoaded', async () => {
        initClassOptions(); 
        
        // æ›´æ–°æ¨™é¡Œ (é˜²æ­¢ HTML å¯«æ­»èˆ‡åƒæ•¸ä¸ä¸€è‡´)
        document.getElementById('article-title-display').textContent = `é–±è®€æ–‡ç« ï¼š${ARTICLE_CONFIG.title}`;
        document.title = `é–±è®€ç†è§£ç·´ç¿’ï¼š${ARTICLE_CONFIG.title}`;

        checkUserLogin();
        
        try {
            await signInAnonymously(auth);
            // ç™»å…¥å¾Œè‹¥æœ‰ä½¿ç”¨è€…è³‡è¨Šï¼Œå˜—è©¦è¼‰å…¥æ­·å²
            if(currentUser) loadHistory(); 
        } catch (e) {
            console.error("Auth Error", e);
        }
    });

    function initClassOptions() {
        const select = document.getElementById('classNumberSelect');
        for(let i = 1; i <= 6; i++) {
            const opt = document.createElement('option');
            opt.value = `${i}ç­`;
            opt.textContent = `${i}ç­`;
            select.appendChild(opt);
        }
        const extras = ["7ç­", "8ç­", "9ç­", "10ç­", "å…¶ä»–"];
        extras.forEach(ex => {
            const opt = document.createElement('option');
            opt.value = ex;
            opt.textContent = ex;
            select.appendChild(opt);
        });
    }

    function checkUserLogin() {
        const storedUser = localStorage.getItem('shimen_pirls_user');
        if (storedUser) {
            currentUser = JSON.parse(storedUser);
            updateUserUI();
            document.getElementById('loginModal').style.display = 'none';
        } else {
            document.getElementById('loginModal').style.display = 'flex';
        }
    }

    window.saveUserInfo = function() {
        const grade = document.getElementById('gradeSelect').value;
        const classNum = document.getElementById('classNumberSelect').value;
        const name = document.getElementById('studentName').value.trim();
        const seat = document.getElementById('seatNumber').value.trim();

        if (!grade || !classNum || !name) {
            alert("è«‹å®Œæ•´é¸æ“‡å¹´ç´šã€ç­ç´šä¸¦è¼¸å…¥å§“åï¼"); 
            return;
        }
        
        const finalClass = `${grade}å¹´${classNum}`;

        currentUser = {
            class: finalClass, 
            name: name,
            seat: seat,
            fullId: `${finalClass}-${seat ? seat + '-' : ''}${name}`
        };

        localStorage.setItem('shimen_pirls_user', JSON.stringify(currentUser));
        updateUserUI();
        document.getElementById('loginModal').style.display = 'none';
        startTime = new Date();
        loadHistory();
    };

    window.resetUser = function() {
        if(confirm("ç¢ºå®šè¦åˆ‡æ›ä½¿ç”¨è€…å—ï¼Ÿ")) {
            localStorage.removeItem('shimen_pirls_user');
            location.reload();
        }
    };

    function updateUserUI() {
        const displayStr = `${currentUser.class} ${currentUser.name}`;
        document.getElementById('mobile-user-name').textContent = displayStr;
        document.getElementById('desktop-user-name').textContent = displayStr;
    }

    window.checkAnswers = async function() {
        if (!currentUser) {
            alert("è«‹å…ˆç™»å…¥ï¼");
            location.reload();
            return;
        }

        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.textContent = "è©•åˆ†èˆ‡å„²å­˜ä¸­...";

        let score = 0;
        let answersRecord = {}; 
        
        for (let i = 1; i <= 4; i++) {
            const selected = document.querySelector(`input[name="q${i}"]:checked`);
            const expDiv = document.getElementById(`exp${i}`);
            const userVal = selected ? selected.value : "";
            const correctVal = ARTICLE_CONFIG.answers[i-1];
            
            answersRecord[`q${i}`] = userVal;

            expDiv.className = "explanation show";
            if (userVal === correctVal) {
                score++;
                expDiv.innerHTML = `âœ… <strong>æ­£ç¢ºï¼</strong>`;
                expDiv.classList.add("correct");
                expDiv.classList.remove("incorrect");
            } else {
                expDiv.innerHTML = `âŒ <strong>éœ€è¦è¤‡ç¿’ï¼š</strong> ${ARTICLE_CONFIG.hints[i-1]}`;
                expDiv.classList.add("incorrect");
                expDiv.classList.remove("correct");
            }
        }

        const finalScore = (score / 4) * 100;
        const timeTaken = Math.round((new Date() - startTime) / 1000);

        const statsDiv = document.getElementById('current-stats');
        statsDiv.style.display = 'block';
        statsDiv.innerHTML = `
            <h3 style="margin-top:0; color: #00008b;">ğŸ“ æœ¬æ¬¡æ¸¬é©—çµæœ</h3>
            <div style="display: flex; justify-content: space-around; align-items: center; margin-bottom: 10px;">
                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; font-weight: bold; color:${finalScore === 100 ? '#28a745' : '#dc3545'}">${finalScore}</div>
                    <div style="font-size: 0.9rem; color: #666;">å¾—åˆ†</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #4169e1;">${timeTaken}</div>
                    <div style="font-size: 0.9rem; color: #666;">ç§’æ•¸</div>
                </div>
            </div>
            <p style="text-align: center; margin: 0; font-size: 0.9rem; color: #888;">æˆç¸¾å·²ä¸Šå‚³é›²ç«¯</p>
        `;
        
        const offset = 100;
        const elementPosition = statsDiv.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - offset;

        window.scrollTo({
             top: offsetPosition,
             behavior: "smooth"
        });

        try {
            // 1. å¯«å…¥å…¬é–‹è³‡æ–™åº« (ä¾›è€å¸«å¾Œå°èˆ‡æ­·å²æŸ¥è©¢ä½¿ç”¨)
            const publicRef = collection(db, 'artifacts', appId, 'public', 'data', 'quiz_results');
            const recordData = {
                classId: currentUser.class, // è³‡æ–™åº«ä¸€è‡´æ€§å‘½å
                studentName: currentUser.name,
                seatNumber: currentUser.seat,
                studentFullId: currentUser.fullId,
                articleId: ARTICLE_CONFIG.id,
                articleTitle: ARTICLE_CONFIG.title,
                score: finalScore,
                answers: answersRecord,
                timeTakenSeconds: timeTaken,
                timestamp: serverTimestamp(),
                deviceInfo: navigator.userAgent
            };

            // é›™é‡å¯«å…¥æ©Ÿåˆ¶
            addDoc(publicRef, recordData).catch(e => console.warn("Public write failed:", e));

            // 2. å¯«å…¥å€‹äººè³‡æ–™åº« (å‚™ä»½)
            if (auth.currentUser) {
                const userRef = collection(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'quiz_results');
                await addDoc(userRef, recordData);
            }

            // 3. æ›´æ–°é¦–é çµ±è¨ˆ
            const statsRef = doc(db, 'artifacts', appId, 'public', 'data', 'pirls_stats', `pirls_${ARTICLE_CONFIG.id}`);
            setDoc(statsRef, { 
                count: increment(1),
                title: ARTICLE_CONFIG.title 
            }, { merge: true }).catch(e => console.warn("Stats update failed:", e));

            // é‡æ–°è¼‰å…¥æ­·å²
            // åŠ å…¥ä¸€é»å»¶é²ä»¥ç¢ºä¿Firestoreå¯«å…¥å¾Œè®€å–å¾—åˆ°
            setTimeout(loadHistory, 500);

        } catch (error) {
            console.error("Save Error:", error);
            alert("æˆç¸¾å·²é€å‡ºï¼Œä½†ç„¡æ³•å„²å­˜è‡³é›²ç«¯ã€‚è«‹æª¢æŸ¥ç¶²è·¯æˆ–è«‹ç®¡ç†å“¡æª¢æŸ¥è³‡æ–™åº«æ¬Šé™ã€‚");
        } finally {
            btn.disabled = false;
            btn.textContent = "å†æ¬¡æäº¤ (æ›´æ–°æˆç¸¾)";
            startTime = new Date(); 
        }
    };

    // --- é—œéµå„ªåŒ–ï¼šæ¯”ç…§ index.html è®€å– Public Data ä¸¦å‰ç«¯ç¯©é¸ ---
    // é€™è®“å­¸ç”Ÿæ›è£ç½®æˆ–ç™»å‡ºå¾Œï¼Œåªè¦ç­ç´šå§“åä¸€æ¨£ï¼Œå°±èƒ½çœ‹åˆ°èˆŠç´€éŒ„
    async function loadHistory() {
        if (!currentUser) return;

        const listDiv = document.getElementById('history-list');
        listDiv.innerHTML = '<div style="text-align:center; color:#888;">è¼‰å…¥ä¸­...</div>';
        
        const targetClass = currentUser.class;
        const targetName = currentUser.name;

        try {
            // è®€å– public/data/quiz_results (é€™è£¡æœ‰æ‰€æœ‰äººè³‡æ–™)
            const publicResultsRef = collection(db, 'artifacts', appId, 'public', 'data', 'quiz_results');
            // é è¨­ä¾æ™‚é–“æ’åº
            const q = query(publicResultsRef, orderBy('timestamp', 'desc'));
            
            const snapshot = await getDocs(q);
            
            let records = [];

            snapshot.forEach((doc) => {
                const data = doc.data();
                
                // æ¬„ä½æ¯”å° (è™•ç†èˆŠè³‡æ–™å¯èƒ½çš„æ¬„ä½åç¨±å·®ç•°)
                const recordClass = data.classId || data.class || "";
                const recordName = data.studentName || data.name || "";

                // 1. ç¯©é¸ä½¿ç”¨è€… (ç­ç´š & å§“å)
                if (String(recordClass).trim() === String(targetClass).trim() && 
                    String(recordName).trim() === String(targetName).trim()) {
                    
                    // 2. ç¯©é¸æœ¬ç¯‡æ–‡ç« 
                    if (data.articleId == ARTICLE_CONFIG.id) {
                        records.push({
                            ...data,
                            date: data.timestamp ? data.timestamp.toDate() : new Date()
                        });
                    }
                }
            });

            if (records.length === 0) {
                listDiv.innerHTML = "<p style='color:#888; text-align:center;'>å°šç„¡æœ¬ç¯‡æ–‡ç« çš„ç·´ç¿’ç´€éŒ„ã€‚</p>";
                return;
            }

            listDiv.innerHTML = records.map(r => {
                const dateStr = r.date.toLocaleString('zh-TW', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                const scoreClass = r.score === 100 ? 'high-score' : (r.score < 60 ? 'low-score' : '');
                return `
                    <div class="history-item ${scoreClass}">
                        <div style="display:flex; align-items:center;">
                            <div style="font-weight:bold; font-size:1.1rem; margin-right:10px; width: 50px;">${r.score}åˆ†</div>
                            <div style="font-size:0.85rem; color:#666;">è€—æ™‚ ${r.timeTakenSeconds}ç§’</div>
                        </div>
                        <div style="font-size:0.8rem; color:#999;">${dateStr}</div>
                    </div>
                `;
            }).join('');

        } catch (error) {
            console.error("Load History Error:", error);
            listDiv.innerHTML = `<p style='color:red; font-size:0.8rem;'>è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚</p>`;
        }
    }
</script>
</body>
</html>